<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Helper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">deCOVID</a> &gt; <a href="index.source.html" class="el_package">comp3111.covid</a> &gt; <span class="el_source">Helper.java</span></div><h1>Helper.java</h1><pre class="source lang-java linenums">package comp3111.covid;

import java.text.SimpleDateFormat;
import java.time.LocalDate;
import java.time.ZoneId;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Date;
import java.util.List;
import javafx.collections.ObservableList;
import javafx.scene.Node;
import javafx.scene.control.CheckBox;
import javafx.scene.control.ChoiceBox;
import javafx.scene.control.DateCell;
import javafx.scene.control.DatePicker;
import javafx.scene.control.ListView;


/** Collection of helper functions for Controller UI. */
<span class="nc" id="L20">public class Helper {</span>
	
	/** Date format for time stamp shown in the text area console. */
<span class="fc" id="L23">	private static SimpleDateFormat sdf_t=new SimpleDateFormat(&quot;[HH:mm:ss]&quot;);</span>
	
	/** Return the time in the format [HH:mm:ss]. */
	public static String getTime() {
<span class="fc" id="L27">		return sdf_t.format(new Date());</span>
	}
	
	/** Get all selected countries in the ListView of CheckBoxes. */
    public static String[] getSelectedCountriesIn(ListView&lt;Node&gt; listview) {
<span class="pc bpc" id="L32" title="1 of 2 branches missed.">    	if(listview==null) return null;</span>
    	
<span class="fc" id="L34">    	ArrayList&lt;String&gt; countryList=new ArrayList&lt;&gt;();</span>
<span class="fc" id="L35">    	ObservableList&lt;Node&gt; countriesSelect=listview.getItems();</span>
<span class="fc bfc" id="L36" title="All 2 branches covered.">    	for(Node n:countriesSelect) {</span>
<span class="pc bpc" id="L37" title="1 of 2 branches missed.">    		if(n instanceof CheckBox) {</span>
<span class="fc" id="L38">    			CheckBox c=(CheckBox)n;</span>
<span class="fc bfc" id="L39" title="All 2 branches covered.">    			if(c.isSelected()) {</span>
<span class="fc" id="L40">    				 countryList.add(c.getText());</span>
    			}
    		}
<span class="fc" id="L43">    	}</span>
<span class="fc" id="L44">    	String[] countries=countryList.toArray(new String[0]);</span>
<span class="fc" id="L45">    	return countries;</span>
    }
    
    /** Get all countries in the ListView of CheckBoxes. */
    public static String[] getAllCountriesIn(ListView&lt;Node&gt; listview) {
<span class="pc bpc" id="L50" title="1 of 2 branches missed.">    	if(listview==null) return null;</span>
    	
<span class="fc" id="L52">    	ArrayList&lt;String&gt; countryList=new ArrayList&lt;&gt;();</span>
<span class="fc" id="L53">    	ObservableList&lt;Node&gt; countriesSelect=listview.getItems();</span>
<span class="fc bfc" id="L54" title="All 2 branches covered.">    	for(Node n:countriesSelect) {</span>
<span class="pc bpc" id="L55" title="1 of 2 branches missed.">    		if(n instanceof CheckBox) {</span>
<span class="fc" id="L56">    			CheckBox c=(CheckBox)n;</span>
<span class="fc" id="L57">    			countryList.add(c.getText());</span>
    		}
<span class="fc" id="L59">    	}</span>
<span class="fc" id="L60">    	String[] countries=countryList.toArray(new String[0]);</span>
<span class="fc" id="L61">    	return countries;</span>
    }
    
    /** Get Date from LocalDate */
    public static LocalDate getLocalDate(Date date) {
<span class="fc" id="L66">    	return date.toInstant().atZone(ZoneId.systemDefault()).toLocalDate();</span>
    }
    
    /** Get LocalDate from Date */
    public static Date getDate(LocalDate date) {
<span class="fc" id="L71">    	return Date.from(date.atStartOfDay(ZoneId.systemDefault()).toInstant());</span>
    }
    
    /** Get selected date from DatePicker. */
    public static Date getSelectedDate(DatePicker datepicker) {
<span class="fc" id="L76">    	LocalDate localDate=datepicker.getValue();</span>
<span class="fc" id="L77">    	return getDate(localDate);</span>
    }
    
    /** Restrict range of DatePicker. */
    public static void restrictDate(DatePicker datepicker, LocalDate start, LocalDate end) {
<span class="pc" id="L82">    	datepicker.setDayCellFactory(d-&gt;new DateCell() {</span>
    		@Override
    		public void updateItem(LocalDate item, boolean empty) {
<span class="nc" id="L85">    			super.updateItem(item,empty);</span>
<span class="nc bnc" id="L86" title="All 4 branches missed.">    			setDisable(item.isAfter(end) || item.isBefore(start));</span>
<span class="nc" id="L87">    		}</span>
    	});
<span class="fc" id="L89">    }</span>
    
    /** Initialize DatePicker by the date range of records. */
    public static void initDatePickers(DatePicker start, DatePicker end) {
<span class="fc" id="L93">    	Date[] range= {null,null};</span>
    	try {    		
<span class="fc" id="L95">    		range=DataReader.getDateRange();</span>
    	}
<span class="nc" id="L97">    	catch(Exception e) {</span>
<span class="nc" id="L98">    		e.printStackTrace();</span>
<span class="nc" id="L99">    		range[0]=Helper.getDate(LocalDate.of(2020, 1, 1));</span>
<span class="nc" id="L100">    		range[1]=Helper.getDate(LocalDate.of(2021, 7, 20));</span>
<span class="fc" id="L101">    	}</span>
<span class="fc" id="L102">    	Helper.initDatePicker(start, range[0], range);</span>
<span class="fc" id="L103">    	Helper.initDatePicker(end, range[1], range);</span>
<span class="fc" id="L104">    }</span>
    
    /** Initialize DatePicker by specific range and date. */
    private static void initDatePicker(DatePicker datepicker, Date date, Date[] range) {
<span class="fc bfc" id="L108" title="All 2 branches covered.">    	if(datepicker==null) return;</span>
<span class="fc" id="L109">    	LocalDate startDate=Helper.getLocalDate(range[0]);</span>
<span class="fc" id="L110">    	LocalDate endDate=Helper.getLocalDate(range[1]);</span>
<span class="fc" id="L111">    	datepicker.setValue(getLocalDate(date));</span>
<span class="fc" id="L112">    	Helper.restrictDate(datepicker,startDate,endDate);</span>
<span class="fc" id="L113">    	datepicker.getEditor().setDisable(true);</span>
<span class="fc" id="L114">    	datepicker.getEditor().setOpacity(1);</span>
<span class="fc" id="L115">    }</span>
    
    /** Reset items in selection ListView with an array of CheckBox names. */
    public static void resetSelection(ListView&lt;Node&gt; listview, String[] names) {
<span class="fc" id="L119">    	listview.getItems().clear();</span>
<span class="fc bfc" id="L120" title="All 2 branches covered.">    	if(names==null) {</span>
<span class="fc" id="L121">    		return;</span>
    	}
<span class="fc bfc" id="L123" title="All 2 branches covered.">    	for(String n:names) {    		</span>
<span class="fc" id="L124">    		listview.getItems().add(new CheckBox(n));</span>
    	}
<span class="fc" id="L126">    }</span>
    
    /** Select CheckBoxes in ListView by the names. */
    public static void selectCheckBox(ListView&lt;Node&gt; listview, String[] names) {
<span class="fc bfc" id="L130" title="All 4 branches covered.">    	if(listview==null || names==null) return;</span>
<span class="fc" id="L131">    	Object[] checkboxes=listview.getItems().toArray();</span>
<span class="fc" id="L132">    	List&lt;String&gt; nameList=Arrays.asList(names);</span>
<span class="fc bfc" id="L133" title="All 2 branches covered.">    	for(Object o:checkboxes) {</span>
<span class="fc bfc" id="L134" title="All 2 branches covered.">    		if(o instanceof CheckBox) {</span>
<span class="fc" id="L135">    			CheckBox c=(CheckBox)o;</span>
<span class="fc" id="L136">    			String cName=c.getText();</span>
<span class="fc bfc" id="L137" title="All 2 branches covered.">        		if(nameList.contains(cName)) {</span>
<span class="fc" id="L138">        			c.setSelected(true);</span>
        		}
    		}
    		
    	}
<span class="fc" id="L143">    }</span>
    
    /** Select all CheckBoxes in ListView. */
    public static void selectAll(ListView&lt;Node&gt; listview) {
<span class="fc bfc" id="L147" title="All 2 branches covered.">    	for(Object o:listview.getItems()) {</span>
<span class="fc bfc" id="L148" title="All 2 branches covered.">    		if(o instanceof CheckBox) {</span>
<span class="fc" id="L149">    			CheckBox c=(CheckBox)o;</span>
<span class="fc" id="L150">    			c.setSelected(true);</span>
    		}
<span class="fc" id="L152">    	}</span>
<span class="fc" id="L153">    }</span>
    
    /** Deselect all CheckBoxes in ListView. */
    public static void deselectAll(ListView&lt;Node&gt; listview) {
<span class="fc bfc" id="L157" title="All 2 branches covered.">    	for(Object o:listview.getItems()) {</span>
<span class="fc bfc" id="L158" title="All 2 branches covered.">    		if(o instanceof CheckBox) {</span>
<span class="fc" id="L159">    			CheckBox c=(CheckBox)o;</span>
<span class="fc" id="L160">    			c.setSelected(false);</span>
    		}
<span class="fc" id="L162">    	}</span>
<span class="fc" id="L163">    }</span>
    
    /** Initialize continent and country filters in Task A. */
    public static void initTaskAFilters(CheckBox continentFilter, CheckBox countryFilter, ListView listview, ChoiceBox sortRule) {
<span class="fc" id="L167">    	countryFilter.setSelected(true);</span>
<span class="fc" id="L168">    	continentFilter.setSelected(true);</span>
<span class="fc" id="L169">    	countryFilter.setOnAction((e)-&gt;{</span>
<span class="fc" id="L170">    		boolean continentSelected=continentFilter.isSelected();</span>
<span class="fc" id="L171">    		boolean countrySelected=countryFilter.isSelected();</span>
<span class="fc" id="L172">    		String[] selected=Helper.getSelectedCountriesIn(listview);</span>
<span class="fc bfc" id="L173" title="All 2 branches covered.">    		if(countrySelected) {</span>
<span class="fc" id="L174">    			Helper.resetSelection(listview,DataReader.getCountries(continentSelected));</span>
    		}
<span class="pc bpc" id="L176" title="1 of 2 branches missed.">    		else if(continentSelected){</span>
<span class="nc" id="L177">    			Helper.resetSelection(listview,DataReader.getReportedContinents());</span>
    		}
<span class="fc" id="L179">    		else Helper.resetSelection(listview,null);</span>
<span class="fc" id="L180">    		Helper.selectCheckBox(listview,selected);</span>
<span class="fc" id="L181">    		String msg=Helper.sortBy(listview,(String)sortRule.getSelectionModel().getSelectedItem());</span>
<span class="fc" id="L182">    		System.out.println(msg);</span>
<span class="fc" id="L183">    	});</span>
<span class="fc" id="L184">    	continentFilter.setOnAction((e)-&gt;{</span>
<span class="fc" id="L185">    		boolean continentSelected=continentFilter.isSelected();</span>
<span class="fc" id="L186">    		boolean countrySelected=countryFilter.isSelected();</span>
<span class="fc" id="L187">    		String[] selected=Helper.getSelectedCountriesIn(listview);</span>
<span class="fc bfc" id="L188" title="All 2 branches covered.">    		if(countrySelected) {</span>
<span class="fc" id="L189">    			Helper.resetSelection(listview,DataReader.getCountries(continentSelected));</span>
    		}
<span class="pc bpc" id="L191" title="1 of 2 branches missed.">    		else if(continentSelected){</span>
<span class="fc" id="L192">    			Helper.resetSelection(listview,DataReader.getReportedContinents());</span>
    		}
<span class="nc" id="L194">    		else Helper.resetSelection(listview,null);</span>
<span class="fc" id="L195">    		Helper.selectCheckBox(listview,selected);</span>
<span class="fc" id="L196">    		String msg=Helper.sortBy(listview,(String)sortRule.getSelectionModel().getSelectedItem());</span>
<span class="fc" id="L197">    		System.out.println(msg);</span>
<span class="fc" id="L198">    	});</span>
<span class="fc" id="L199">    }</span>
    
    /** Initialize ListView sorting methods in Task A choice box. */
    public static void initTaskASortChoices(ChoiceBox sortRules, ListView listview) {
<span class="fc" id="L203">    	sortRules.getItems().clear();</span>
<span class="fc" id="L204">    	sortRules.getItems().addAll(&quot;By name&quot;,&quot;By continent&quot;,&quot;By latest total cases&quot;,&quot;By latest total cases per million&quot;);</span>
<span class="fc" id="L205">    	sortRules.getSelectionModel().select(&quot;By name&quot;);</span>
<span class="fc" id="L206">    	sortRules.setOnAction((e)-&gt;{</span>
<span class="fc" id="L207">    		Object o=sortRules.getSelectionModel().getSelectedItem();</span>
<span class="pc bpc" id="L208" title="1 of 2 branches missed.">    		if(o instanceof String) {</span>
<span class="fc" id="L209">    			String s=(String)o;</span>
<span class="fc" id="L210">    			String msg=Helper.sortBy(listview,s);</span>
<span class="fc" id="L211">    			System.out.println(msg);</span>
    		}
<span class="fc" id="L213">    	});</span>
<span class="fc" id="L214">    }</span>
    
    /** Sort the location CheckBoxes in ListView by a certain rule:
     *  &quot;By name&quot;,&quot;By continent&quot;,&quot;By latest total cases&quot;,&quot;By latest total cases per million&quot;.
     *  */
    public static String sortBy(ListView&lt;Node&gt; listview, String rule) {
<span class="fc" id="L220">    	String[] allCountries=Helper.getAllCountriesIn(listview);</span>
<span class="fc" id="L221">    	String[] selectedCountries=Helper.getSelectedCountriesIn(listview);</span>
<span class="fc" id="L222">    	String msg=null;</span>
<span class="fc bfc" id="L223" title="All 2 branches covered.">		if(rule.equals(&quot;By name&quot;)) {</span>
<span class="fc" id="L224">			Arrays.sort(allCountries);</span>
<span class="fc" id="L225">			msg=(&quot;Filter sorted by name. &quot;+getTime());</span>
		}
<span class="fc bfc" id="L227" title="All 2 branches covered.">		else if(rule.equals(&quot;By latest total cases&quot;)) {</span>
<span class="fc" id="L228">			DataReader.sortByLocationDate();</span>
<span class="fc" id="L229">			Arrays.sort(allCountries,(a,b)-&gt;{</span>
<span class="fc" id="L230">				int indexA=DataReader.findByLocation(a)[1];</span>
<span class="fc" id="L231">				int indexB=DataReader.findByLocation(b)[1];</span>
				
<span class="fc" id="L233">				String totalA=DataReader.getRecord(indexA).get(&quot;total_cases&quot;);</span>
<span class="fc" id="L234">				String totalB=DataReader.getRecord(indexB).get(&quot;total_cases&quot;);</span>
<span class="fc" id="L235">				long totalANum=0;</span>
<span class="fc" id="L236">				long totalBNum=0;</span>
<span class="pc bpc" id="L237" title="1 of 2 branches missed.">				if(!totalA.isEmpty()) totalANum=Long.parseLong(totalA);</span>
<span class="pc bpc" id="L238" title="1 of 2 branches missed.">				if(!totalB.isEmpty()) totalBNum=Long.parseLong(totalB);</span>
<span class="fc" id="L239">				long result=totalANum-totalBNum;</span>
<span class="fc bfc" id="L240" title="All 2 branches covered.">				if(result&lt;0) return 1;</span>
<span class="fc bfc" id="L241" title="All 2 branches covered.">				else if(result==0) return 0;</span>
<span class="fc" id="L242">				return -1;</span>
			});
<span class="fc" id="L244">			msg=(&quot;Filter sorted by latest total cases. &quot;+getTime());</span>
		}
<span class="fc bfc" id="L246" title="All 2 branches covered.">		else if(rule.equals(&quot;By latest total cases per million&quot;)) {</span>
<span class="fc" id="L247">			DataReader.sortByLocationDate();</span>
<span class="fc" id="L248">			Arrays.sort(allCountries,(a,b)-&gt;{</span>
<span class="fc" id="L249">				int indexA=DataReader.findByLocation(a)[1];</span>
<span class="fc" id="L250">				int indexB=DataReader.findByLocation(b)[1];</span>
<span class="fc" id="L251">				String totalA=DataReader.getRecord(indexA).get(&quot;total_cases_per_million&quot;);</span>
<span class="fc" id="L252">				String totalB=DataReader.getRecord(indexB).get(&quot;total_cases_per_million&quot;);</span>
<span class="fc" id="L253">				float totalANum=0;</span>
<span class="fc" id="L254">				float totalBNum=0;</span>
<span class="pc bpc" id="L255" title="1 of 2 branches missed.">				if(!totalA.isEmpty()) totalANum=Float.parseFloat(totalA);</span>
<span class="pc bpc" id="L256" title="1 of 2 branches missed.">				if(!totalB.isEmpty()) totalBNum=Float.parseFloat(totalB);</span>
<span class="fc" id="L257">				float result=totalANum-totalBNum;</span>
<span class="fc bfc" id="L258" title="All 2 branches covered.">				if(result&lt;0) return 1;</span>
<span class="fc bfc" id="L259" title="All 2 branches covered.">				else if(result==0) return 0;</span>
<span class="fc" id="L260">				return -1;</span>
			});
<span class="fc" id="L262">			msg=(&quot;Filter sorted by latest total cases per million. &quot;+getTime());</span>
		}
<span class="pc bpc" id="L264" title="1 of 2 branches missed.">		else if(rule.equals(&quot;By continent&quot;)) {</span>
<span class="fc" id="L265">			final List&lt;String&gt; continents=Arrays.asList(DataReader.getReportedContinents());</span>
			
<span class="fc" id="L267">			Arrays.sort(allCountries,(a,b)-&gt;{</span>
				String contA,contB;
<span class="fc bfc" id="L269" title="All 2 branches covered.">				if(continents.contains(a)) {</span>
<span class="fc" id="L270">					contA=a;</span>
<span class="fc" id="L271">					a=&quot;&quot;;</span>
				}
				else {
<span class="fc" id="L274">					int indexA=DataReader.findByLocation(a)[1];</span>
<span class="fc" id="L275">					contA=DataReader.getRecord(indexA).get(&quot;continent&quot;);</span>
				}
<span class="fc bfc" id="L277" title="All 2 branches covered.">				if(continents.contains(b)) {</span>
<span class="fc" id="L278">					contB=b;</span>
<span class="fc" id="L279">					b=&quot;&quot;;</span>
				}
				else {
<span class="fc" id="L282">					int indexB=DataReader.findByLocation(b)[1];</span>
<span class="fc" id="L283">					contB=DataReader.getRecord(indexB).get(&quot;continent&quot;);</span>
				}
<span class="fc" id="L285">				int result=contA.compareTo(contB);</span>
<span class="fc bfc" id="L286" title="All 2 branches covered.">				if(result==0) {</span>
<span class="fc" id="L287">					result=a.compareTo(b);</span>
				}
<span class="fc" id="L289">				return result;</span>
			});
<span class="fc" id="L291">			msg=(&quot;Filter sorted by continent. &quot;+getTime());</span>
		}
<span class="fc" id="L293">		Helper.resetSelection(listview,allCountries);</span>
<span class="fc" id="L294">		Helper.selectCheckBox(listview,selectedCountries);</span>
<span class="fc" id="L295">		return msg;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>